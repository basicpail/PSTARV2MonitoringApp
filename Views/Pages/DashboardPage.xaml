<Page
    x:Class="PSTARV2MonitoringApp.Views.Pages.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:PSTARV2MonitoringApp.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:Controls="clr-namespace:PSTARV2MonitoringApp.Views.Controls"
    Title="DashboardPage"
    d:DataContext="{d:DesignInstance local:DashboardPage,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="720"
    d:DesignWidth="1280"
    ui:Design.Background="{ui:ThemeResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{ui:ThemeResource TextFillColorPrimaryBrush}"
    Foreground="{ui:ThemeResource TextFillColorPrimaryBrush}"
    ScrollViewer.CanContentScroll="True"
    mc:Ignorable="d">

    <!-- 한 번만 선언하는 Resources -->
    <Page.Resources>
        <!-- DataGrid 공통 헤더 스타일 -->
        <Style x:Key="GridHeaderStyle" TargetType="DataGridColumnHeader">
            <!--<Setter Property="Background" Value="{DynamicResource SecondaryBackgroundBrush}"/>-->
            <Setter Property="Background" Value="#434343"/>
            <Setter Property="Foreground" Value="{ui:ThemeResource TextFillColorPrimaryBrush}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="{DynamicResource DividerColorBrush}"/>
            <Setter Property="Padding" Value="8,6"/>
        </Style>

        <!-- DataGrid RowStyle 정의 -->
        <Style x:Key="NoCornerRadiusRowStyle" TargetType="DataGridRow">
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="OverridesDefaultStyle" Value="True"/>
            <Setter Property="BorderBrush" Value="{DynamicResource GridLineBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="{DynamicResource RowBackgroundBrush}"/>
            <!-- Template에서 CornerRadius만 0으로 -->
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridRow">
                        <Border x:Name="RowBorder"
                              Background="{TemplateBinding Background}" 
                              BorderBrush="{TemplateBinding BorderBrush}"
                              BorderThickness="{TemplateBinding BorderThickness}"
                              CornerRadius="0">
                            <DataGridCellsPresenter/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- DataGrid 공통 셀 스타일 -->
        <Style x:Key="GridCellStyle" TargetType="DataGridCell">
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
    </Page.Resources>
    
    
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="2*" />
            <RowDefinition Height="auto"/>
            <RowDefinition Height="1*"/>
        </Grid.RowDefinitions>

        <!-- 상단: 두 개의 카드 -->
        <Grid Grid.Row="0" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- ▶ 종합 상황 정보 카드 -->
            <ui:Card
                Grid.Column="0"
                Background="#323232"
                BorderBrush="#434343"
                BorderThickness="1"
                Margin="0,0,8,0">

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="300"/>
                    </Grid.RowDefinitions>

                    <!-- ① Header 영역 -->
                    <Grid Grid.Row="0" Margin="16,0,16,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="118*"/>
                            <ColumnDefinition Width="23*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Grid.ColumnSpan="2">
                            <ui:SymbolIcon Symbol="Info28" FontSize="20" FontWeight="Bold" Margin="0,0,8,0" Foreground="#4F8EF7"/>
                            <TextBlock Text="종합 상황 정보"
                                FontSize="14"
                                FontWeight="SemiBold"
                                Foreground="#F3F3F3"
                                VerticalAlignment="Center"/>
                        </StackPanel>

                        <!-- 우측 필터 버튼 -->
                        <ui:Button Grid.Column="2"
                            Content="필터"
                            Background="#212121"
                            Foreground="#F3F3F3"
                            BorderBrush="#33334D"/>
                    </Grid>

                    <!-- ② Content 영역: Summary DataGrid -->
                    <DataGrid
                        Grid.Row="1"
                        ItemsSource="{Binding ViewModel.TestSituationLogTestItems}"
                        ColumnHeaderStyle="{StaticResource GridHeaderStyle}"
                        CellStyle="{StaticResource GridCellStyle}"
                        RowStyle="{StaticResource NoCornerRadiusRowStyle}"
                        AutoGenerateColumns="False"
                        CanUserAddRows="False"
                        HeadersVisibility="Column"
                        GridLinesVisibility="All"
                        RowBackground="#101010"
                        AlternatingRowBackground="#212121"
                        IsReadOnly="True"
                        BorderBrush="#000000"
                        Foreground="#000000"
                        Background="#000000"
                        >
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Date"     Binding="{Binding Date, StringFormat=HH:mm:ss}" Width ="2*" MinWidth="150"/>
                            <DataGridTextColumn Header="ID"       Binding="{Binding Id}"                          Width="*" MinWidth="50"/>
                            <DataGridTextColumn Header="Contents" Binding="{Binding Contents}"                    Width="8*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </ui:Card>

            <!-- ▶ Raw Data 카드 -->
            <ui:Card
            Grid.Column="1"
            Background="#323232"
            BorderBrush="#434343"
            BorderThickness="1"
            Margin="8,0,0,0">

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="300"/>
                    </Grid.RowDefinitions>

                    <!-- ① Header -->
                    <Grid Grid.Row="0" Margin="16,12,16,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <ui:SymbolIcon Symbol="Info28" FontSize="20" FontWeight="Bold" Margin="0,0,8,0" Foreground="#4F8EF7"/>
                            <!--<ui:InfoBadge Icon="Info28" Margin="0,0,8,0"/>-->
                            <TextBlock Text="Raw Data"
                                FontSize="14"
                                FontWeight="SemiBold"
                                Foreground="#F3F3F3"
                                VerticalAlignment="Center"/>
                        </StackPanel>

                        <!-- 출력 시작 버튼 -->
                        <ui:Button Grid.Column="1"
                            Content="출력 시작"
                            Margin="8,0,4,0"
                            Background="#212121"
                            Foreground="#F3F3F3"
                            BorderBrush="#33334D"/>
                        <!-- 필터 버튼 -->
                        <ui:Button Grid.Column="2"
                            Content="필터"
                            Background="#212121"
                            Foreground="#F3F3F3"
                            BorderBrush="#33334D"/>
                    </Grid>

                    <!-- ② Content: Raw Data DataGrid -->
                    <DataGrid
                        Grid.Row="1"
                        ItemsSource="{Binding ViewModel.TestRawDataTimelineItems}"
                        ColumnHeaderStyle="{StaticResource GridHeaderStyle}"
                        CellStyle="{StaticResource GridCellStyle}"
                        RowStyle="{StaticResource NoCornerRadiusRowStyle}"
                        AutoGenerateColumns="False"
                        CanUserAddRows="False"
                        HeadersVisibility="Column"
                        GridLinesVisibility="All"
                        RowBackground="#101010"
                        AlternatingRowBackground="#212121"
                        IsReadOnly="True"
                        BorderBrush="#000000"
                        Foreground="#000000"
                        Background="#000000"
                        >
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="STBY Start" Binding="{Binding STBY_Start}"  Width ="*" MinWidth="80"/>
                            <DataGridTextColumn Header="Run Lamp"   Binding="{Binding RunLamp}"     Width ="*" MinWidth="80"/>
                            <DataGridTextColumn Header="Overload"   Binding="{Binding Overload}"    Width ="*" MinWidth="80"/>
                            <DataGridTextColumn Header="Mode"       Binding="{Binding ModeStatus}"  Width ="*" MinWidth="80"/>
                            <DataGridTextColumn Header="Run Req"    Binding="{Binding RUN_req}"     Width ="*" MinWidth="80"/>
                            <DataGridTextColumn Header="Reset Btn"  Binding="{Binding ResetButton}" Width ="*" MinWidth="80"/>
                            <DataGridTextColumn Header="STBY Lamp"  Binding="{Binding StandByLamp}" Width ="*" MinWidth="80"/>
                            <DataGridTextColumn Header="Low Press"  Binding="{Binding TXLowpress}"  Width ="*" MinWidth="80"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </ui:Card>
        </Grid>

        <Grid Grid.Row="1">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,10">
                <ui:Button 
                Content="카드 상태 테스트" 
                Command="{Binding DeviceStatusCardViewModel.UpdateRandomDeviceStatusCommand}"
                Background="#212121"
                Foreground="#F3F3F3"
                BorderBrush="#33334D"
                Margin="0,0,10,0"/>
            </StackPanel>
        </Grid>
        
        <!-- 하단: 개별 ID 상태 카드 3개 -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Grid x:Name="deviceCard" Grid.Column="0" Visibility="Visible">
                <Controls:DeviceStatusCard DataContext="{Binding DeviceStatusCardViewModel.DeviceStatusCardModels}"/>
            </Grid>

            <!-- ID 1 --><!--
            <Grid x:Name="deviceCard1" Grid.Column="0" Visibility="Collapsed">
                <Controls:DeviceStatusCard/>
            </Grid>

            --><!-- ID 2 --><!--
            <Grid x:Name="deviceCard2" Grid.Column="1" Visibility="Collapsed">
                <Controls:DeviceStatusCard />
            </Grid>

            --><!-- ID 3 --><!--
            <Grid x:Name="deviceCard3" Grid.Column="2" Visibility="Collapsed">
                <Controls:DeviceStatusCard />
            </Grid>-->

            
        </Grid>
    </Grid>
</Page>

<!--<Grid VerticalAlignment="Top" Margin="-20,20,0,0">
        <Grid.RowDefinitions>
            <RowDefinition Height="2*" />
            <RowDefinition Height="1*" />
        </Grid.RowDefinitions>
        
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0">
                <ui:TextBlock
                    Text="TB Row 0, Column 0"
                />
            </Grid>
            <Grid Grid.Column="1">
                <Border BorderBrush="Gray" BorderThickness="2" CornerRadius="5">
                    <ui:ListView ItemsSource="{Binding ViewModel.TestRawDataTimelineItems}" ViewState="GridView">
                        <ui:ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                <Setter Property="VerticalContentAlignment"   Value="Center"/>
                            </Style>
                        </ui:ListView.ItemContainerStyle>
                        <ui:ListView.View>
                            <ui:GridView>
                                <GridViewColumn Header="STBY_Start"    DisplayMemberBinding="{Binding STBY_Start}"/>
                                <GridViewColumn Header="RunLamp"       DisplayMemberBinding="{Binding RunLamp}"/>
                                <GridViewColumn Header="Overload"      DisplayMemberBinding="{Binding Overload}"/>
                                <GridViewColumn Header="ModeStatus"    DisplayMemberBinding="{Binding ModeStatus}"/>
                                <GridViewColumn Header="RUN_req"       DisplayMemberBinding="{Binding RUN_req}"/>
                                <GridViewColumn Header="ResetBtn"      DisplayMemberBinding="{Binding ResetButton}"/>
                                <GridViewColumn Header="StandByLamp"   DisplayMemberBinding="{Binding StandByLamp}"/>
                                <GridViewColumn Header="TXLowpress"    DisplayMemberBinding="{Binding TXLowpress}"/>
                            </ui:GridView>
                        </ui:ListView.View>
                    </ui:ListView>
                </Border>
            </Grid>
        </Grid>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid Grid.Column="0">
                <ui:TextBlock
                    Text="TB Row1, Column0"
                    />

            </Grid>
            <Grid Grid.Column="1">
                <ui:TextBlock
                    Text="TB Row1, Column1"
                    />

            </Grid>
            <Grid Grid.Column="2">
                <ui:TextBlock
                    Text="TB Row1, Column2"
                    />

            </Grid>
        </Grid>
    </Grid>-->
